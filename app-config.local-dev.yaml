# Local development configuration - points to local platform-api via port-forward
# Requires: make port-forward (forwards to localhost:10080)

backend:
  auth:
    keys:
      - secret: dev-secret

auth:
  session:
    secret: dev-session-secret
    cookie:
      secure: false
      sameSite: lax
      domain: localhost
  providers:
    keycloak:
      development:
        clientId: backstage
        clientSecret: local-backstage-client-secret
        issuer: https://keycloak.localtest.me/realms/aegis
        metadataUrl: https://keycloak.localtest.me/realms/aegis/.well-known/openid-configuration
        additionalScopes:
          - offline_access
        callbackUrl: http://localhost:7008/api/auth/keycloak/handler/frame
        prompt: login
        signIn:
          resolvers:
            - resolver: emailMatchingUserEntityProfileEmail
            - resolver: emailLocalPartMatchingUserEntityName

proxy:
  reviveConsumedRequestBodies: true
  endpoints: {}

aegis:
  proxy:
    target: 'https://platform-api.localtest.me'
    changeOrigin: true
    credentials: require
    allowedHeaders:
      - Grpc-Metadata-Authorization
      - grpc-metadata-authorization
      - X-Forwarded-Authorization
      - x-forwarded-authorization

  tls:
    caFiles:
      - ${HOME}/aegis-local-trust.pem
